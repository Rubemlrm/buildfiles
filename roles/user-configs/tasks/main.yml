---
- name: Add system user
  user:
    name: '{{ username }}'
    password: "{{ 'changeme' | password_hash('sha512') }}"
    generate_ssh_key: yes
    ssh_key_bits: 2048
    ssh_key_file: .ssh/id_rsa
- name: Change user shell to znc
  raw: chsh {{ username  }} -s /usr/bin/zsh
  ignore_errors: yes

- name: Clone Needed Repos
  git: repo={{item.repo}} dest={{item.dest}}
  with_items:
    - {
        repo: 'https://github.com/robbyrussell/oh-my-zsh.git',
        dest: '/home/{{username}}/.oh-my-zsh',
      }

- name: Created base folders for configs
  file: path={{ home_dir }}/{{item}} state=directory
  with_items:
    - '.config'
    - '.urxvt'
    - '.urxvt/ext'

- name: Restore Configs
  file: src={{ configs_dir }}/{{ item.origin }}
    dest={{ home_dir }}/{{ item.dest }}
    state=link
    force=true
    owner={{username}}
    group={{username}}
  with_items:
    - { origin: 'zsh/zshrc', dest: '.zshrc' }
    - { origin: 'zsh/configs', dest: '.config/zsh' }
    - { origin: 'vim/vimrc', dest: '.vimrc' }
    - { origin: 'vim/vim', dest: '.vim' }
    - { origin: 'Xstuff/Xdefaults', dest: '.Xdefaults' }
    - { origin: 'tmux/tmux.conf', dest: '.tmux.conf' }
    - { origin: 'tmux/configs', dest: '.config/tmux' }
- name: install gnome extension manager
    raw: wget -O gnome-shell-extension-installer https://github.com/brunelli/gnome-shell-extension-installer/raw/master/gnome-shell-extension-installer && chmod +x gnome-shell-extension-installer && mv gnome-shell-extension-installer /usr/bin/
- name: install gnome extensions
    raw: gnome-shell-extension-installer {{item}}
    with_items:
        - 1160 #dash to dock
        - 1530 # tray-cions
        - 750 # openweather
        - 358 # activities configurator
        - 8 #place status indicator